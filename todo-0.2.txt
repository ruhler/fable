Fble 0.2 TODO
=============
Things to consider doing for the fble-0.2 release.

* Big things:
 - smten support.
 - high score saved in invaders game.
 - fix composition issues in fbld implementation.
 - write tutorials for C api.
 - write some serious new fble code.
   image viewer? floating point?

* Why does FbleNewLoc use int for line and col instead of size_t?

* Check if all the fble-module-path.h functions really need to be public API.
* How to handle @file doc comments on header files?
  - Should we write documentation for them somewhere?

* Convert internal doc comments to fbld doc comment format?

* Should @l allow inline tags?
  - For example, I want @l[@config[...]], but it's not doing any substition. I
    guess that makes sense for calling it a 'literal'?

* Figure out whitespace issues with fbld generated roff, man.
  - When are things trimed versus not?
  - How to avoid too many or too few blank lines between items?

* Be able to write doc comments for extern values and types as well as
  functions.

* Write test cases for doc comments extraction and conversion.
  - For example: blank lines in doc comments should be allowed and not cause
    the comment to be truncated.

* Install man pages compressed?

* Add a way to specify package path on the command line?

* Improve exercises for Unions and Functions tutorials, and others.

* Fix timeout with gdb-test
 - Just need to increase it a little in case of heavy CPU load?
 - Next time it happens, try to see where it got stuck?

* How to check errors from stale files in build directory?
  For example, sat/Sat/sat-tests still existed, even though now we're compiling
  to sat/sat-tests, but accidentally referencing the old sat/Sat/sat-tests
  path.
  Perhaps make use of ninja cleandead after generating the build.ninja file?
  Not sure if I want to require ninja 1.10, or if this is a robust solution.
  Maybe depend on full builds from github to catch these issues.

* Review C API for consistency.
  For example: FbleVectorInit inconsistent with FbleFreeVector?

* Optimize the generated build.ninja file to be smaller?
  By introducing rules, and taking advantage of $in, $out, etc?
  The build.ninja file is around 1.1M right now.

* Add smten support to fble.
  see thoughts/fble.smten.txt

* Add way to do inline code syntax highlighting in fbld?
  Because it looks a little funny in the tutorials for things to be
  highlighted in code blocks but not in inline text.

* Fbld Cleanup
 - Come up with a more formal test suite for fbld.
 - Print line and column number on fbld usage errors.
   Instead of 'Index' number.
 - Print line and col number on fbld usage command errors
   Such as wrong number of args.

* Optimize code for generate_c for low gcc memory use:
 - Use shorter labels for function names?
 - Only output labels for pc aborts that are actually jumped to.

* Add test that you can use a unicode character in a literal?

* Do something with .@ module value vs. type?
  - There's currently unexercised code for it.

* Do something with data type instruction?
  - There's currently unexercised code for it.

* [spec] Should empty path be allowed in package type?
 See spec/fble.fbld for more details.

* [modules]
 - Decide about .fble.@ files.
 - Split FbleLoad into FbleLoadProgram and FbleLoadModule.
 - Add support for loading .fble.@ files.
   And presumably some way to test this and something about it in the language
   spec?
 - Test all combinations of .fble/.fble.@, with all combinations of type
   errors in one or the other or both.

* [lib] Move more value conversion functions to separate object files.
 - Color, IO, etc.

* [debugger] Improve support for printing variables
 - Emit lexical scopes where appropriate.
   But what for? What value for printing lexical scopes?

* Consider running some of the tests under valgrind?
 - To catch memory issues that could otherwise go undetected?

* Implement support for packed data values.
 - Change the compiler to allocate FbleDataTypeValue when appropriate.
 - Pass type to struct and union construction and access functions.
 - Implement packing for struct and union values.

* Improve performance with profiling enabled?
 - Now that we removed the optimization for detecting duplicate call entries
   in the stack?
 - see thoughts/fble.profile.txt

* For loaded submodules, should the module profile block be the module file or
  the place where it was imported from?
 - Seems like it should be the module file, because it could be imported from
   multiple places?

* Change FbleProfile functions to accept NULL, and clean up code to take
  advantage of that where it makes sense?

* Use some way other than NULL to disable profiling?
 - To encourage all the apps to support optional profiling, including things
   like fble-md5 and fble-app?
 - Check we are passing meaningful block ids to FbleNewFuncValue.

* Add option for passing .so files to FbleLinkFromCompiledOrSource?

* Print full stack trace on abort instead of just the top stack trace?

* Run fble-test-compile-error tests in compilation mode?

* Consider having separate CALL_INSTR and TAIL_CALL_INSTR.
  Their implementations may be different enough now to warrant it?
  Regardless, we shouldn't switch at runtime on something known statically.
  The 'exit' part of the instruction should be part of the instruction tag.

* [compilation] Add support for .fble.@ files and modular compilation.

* [cleanup] For things like FbleValueAddRef, is it okay if dst is NULL?
 - It would be convenient for constructing things in case of error.
 - I'm not sure if there's any performance implications.
 - It would be nice to specify explicitly and be consistent with this kind of
   thing.

* [tests] Any way to improve memory growth tests?
 It feels wrong to me to have to do a full gc for the tests to pass. It feels
 too specific to the implementation of garbage collection. Anything we can do?

* [/*%] Follow style guide in fble.style.txt
  In particular, union field names should be lowercase: just, true, false, not
  Just, True, False.
* [/*%] Clean up fble library
 - Separate modules as appropriate to reduce false dependencies.
 - Document all functions.
 - Add tests for full code coverage of all functions.
 - Rename Str to String? Or to S?
 - Consider pulling ForEach and Map out into their own class?
* [/Int%] Add test coverage for the Int routines.
* [/Fble/Test%] Clean up fble test framework
 - Use AssertEquals for more of the tests.
 - Add an AssertLt or similar methods? Or generalize AssertEquals?
 - Properly test the test infra.
* [/GameOfLife%] Switch to a target 60 FPS?
* [/Map%] Add tests for balancing of /Map%?
* [/Snake%] Switch to a target 60 FPS?
* [/Snake%] Test and fix bug when snake eats its tail.
* [/Snake%] Ignore moves that aren't orthogonal to current snake direction.
* [/Snake%] Keep track of and report score.
* [/Snake%] Figure out why the background box gets lost some times.

* [libfble] Can fble-stdio check that the function has the right type?

* [spec] Add some way to catch or recover from errors at runtime?
* [spec] Clarify in spec: is it okay to retain a local variable until a function
  exits, even if that means retaining it longer than its lexical scope?
* [spec] Clarify spec on when (compile vs runtime) vacuous value error should be
  reported.
* [spec] Document the runtime memory model,
  - Including that tail recursive functions should not smash the stack.

* [typecheck] Be more consistent in FbleTc about use of vector versus FbleTc*[].
* [typecheck] We don't get a warning about an unused self recursive function.
  More generally, we don't get warnings about variables that are referenced
  only by unused variables.
* [typecheck] Better error messages on types that have the same name but different values?
* [typecheck] Quote funny names in types. For example, the field ',' should have
  quotes in type error messages.
* [typecheck] Better error message for importing something from a module that
  is not defined in the module?
* [typecheck] Test and fix error message for type of anonymous type let values.
 - The type should be the computed type for the value, not the introduced
   abstract type?
* [typecheck] Figure out why FbleNormalType is called so often
 - See if we can fix that to reduce the now annoyingly long compile times.
 - Profiling said its all in FbleTypesEqual. Maybe something pathological?

* Add tests that at least the compiled apps don't crash when you run them.
 - Including with --profile enabled.
