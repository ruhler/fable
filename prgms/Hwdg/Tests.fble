
% True = /Bool%.True;
% False = /Bool%.False;
% Chars = /Char%.Chars;
<@>@ Eq@ = /Eq%.Eq@;
% 2 = /Int/Int%.2;
% 3 = /Int/Int%.3;
<@>@ Maybe@ = /Maybe%.Maybe@;
<@>% Just = /Maybe%.Just;
<@>% Nothing = /Maybe%.Nothing;
<@>@ Show@ = /Show%.Show@;
% Str = /String%.Str;
@ TestSuite@ = /Test%.TestSuite@;
<@>% AssertEquals = /Test%.AssertEquals;
% Test = /Test%.Test;
% TestSuite = /Test%.TestSuite;

@ Coord@ = /Hwdg%.Coord@;
@ Data@ = /Hwdg%.Data@;
@ Layout@ = /Hwdg%.Layout@;
% Data0 = /Hwdg%.0;
% Data1 = /Hwdg%.1;
% Empty = /Hwdg%.Empty;
% ClearData = /Hwdg%.ClearData;
% GetData = /Hwdg%.GetData;
% SetData = /Hwdg%.SetData;

Eq@<Data@> EqData = (Data@ a, Data@ b) {
  a.?(
    0: b.?(0: True, 1: False),
    1: b.?(0: False, 1: True));
};

Show@<Data@> ShowData = (Data@ x) {
  Str(x.?(0: Chars|0, 1: Chars|1));
};

TestSuite@ Tests = TestSuite(Chars|Hwdg, [
  Test(Chars|'empty no data', !({
    Layout@ layout = Empty;
    Maybe@<Data@> got = GetData(layout, Coord@(2, 3));
    Maybe@<Data@> wnt = Nothing<Data@>;

    AssertEquals<Maybe@<Data@>>(
      /Maybe/Eq%.Eq<Data@>(EqData),
      /Maybe/Show%.Show<Data@>(ShowData),
      wnt, got);
  })),

  Test(Chars|'set this data to 0', !({
    Layout@ layout = SetData(Empty, Coord@(2, 3), Data0);
    Maybe@<Data@> got = GetData(layout, Coord@(2, 3));
    Maybe@<Data@> wnt = Just<Data@>(Data0);

    AssertEquals<Maybe@<Data@>>(
      /Maybe/Eq%.Eq<Data@>(EqData),
      /Maybe/Show%.Show<Data@>(ShowData),
      wnt, got);
  })),

  Test(Chars|'set this data to 1', !({
    Layout@ layout = SetData(Empty, Coord@(2, 3), Data1);
    Maybe@<Data@> got = GetData(layout, Coord@(2, 3));
    Maybe@<Data@> wnt = Just<Data@>(Data1);

    AssertEquals<Maybe@<Data@>>(
      /Maybe/Eq%.Eq<Data@>(EqData),
      /Maybe/Show%.Show<Data@>(ShowData),
      wnt, got);
  })),

  Test(Chars|'set other data', !({
    Layout@ layout = SetData(Empty, Coord@(3, 2), Data1);
    Maybe@<Data@> got = GetData(layout, Coord@(2, 3));
    Maybe@<Data@> wnt = Nothing<Data@>;

    AssertEquals<Maybe@<Data@>>(
      /Maybe/Eq%.Eq<Data@>(EqData),
      /Maybe/Show%.Show<Data@>(ShowData),
      wnt, got);
  })),

  Test(Chars|'clear data', !({
    Layout@ layout = ClearData(SetData(Empty, Coord@(2, 3), Data1), Coord@(2, 3));
    Maybe@<Data@> got = GetData(layout, Coord@(2, 3));
    Maybe@<Data@> wnt = Nothing<Data@>;

    AssertEquals<Maybe@<Data@>>(
      /Maybe/Eq%.Eq<Data@>(EqData),
      /Maybe/Show%.Show<Data@>(ShowData),
      wnt, got);
  })),

  Test(Chars|'clear other data', !({
    Layout@ layout = ClearData(SetData(Empty, Coord@(2, 3), Data1), Coord@(3, 2));
    Maybe@<Data@> got = GetData(layout, Coord@(2, 3));
    Maybe@<Data@> wnt = Just<Data@>(Data1);

    AssertEquals<Maybe@<Data@>>(
      /Maybe/Eq%.Eq<Data@>(EqData),
      /Maybe/Show%.Show<Data@>(ShowData),
      wnt, got);
  }))
]);

@(Tests);
